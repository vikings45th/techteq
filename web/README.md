# Web App

Nuxt 4 ã‚’ä½¿ã£ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã§ã™ã€‚`web/` é…ä¸‹ã‹ã‚‰èµ·å‹•ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡
- [æ¦‚è¦](#æ¦‚è¦)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
- [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [ç’°å¢ƒå¤‰æ•°](#ç’°å¢ƒå¤‰æ•°)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [APIä»•æ§˜](#apiä»•æ§˜)
- [é–‹ç™ºã‚¬ã‚¤ãƒ‰](#é–‹ç™ºã‚¬ã‚¤ãƒ‰)
- [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
- [ãƒ‡ãƒ—ãƒ­ã‚¤](#ãƒ‡ãƒ—ãƒ­ã‚¤)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ãƒªãƒ³ã‚¯](#ãƒªãƒ³ã‚¯)

## æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ°—åˆ†ã«åˆã‚ã›ã¦æ•£æ­©ãƒ«ãƒ¼ãƒˆã‚’æ¤œç´¢ãƒ»è¡¨ç¤ºã™ã‚‹Webã‚¢ãƒ—ãƒªã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½
- **ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”¨AIææ¡ˆ**: å¤©å€™ãƒ»æ—¥æ™‚ã‚’è€ƒæ…®ã—ãŸãƒ†ãƒ¼ãƒ/è·é›¢ã®ææ¡ˆï¼ˆ`/api/gemini`ã€Gemini APIï¼‰
- **ãƒ†ãƒ¼ãƒåˆ¥ãƒ«ãƒ¼ãƒˆæ¤œç´¢**: exercise / think / refresh / nature
- **ç¾åœ¨åœ°ãƒ™ãƒ¼ã‚¹æ¤œç´¢**: ä½ç½®æƒ…å ±ã‹ã‚‰é–‹å§‹åœ°ç‚¹ã‚’è¨­å®š
- **ãƒ«ãƒ¼ãƒˆè¡¨ç¤º**: åœ°å›³ä¸Šã«ãƒãƒªãƒ©ã‚¤ãƒ³ã¨ã‚¹ãƒãƒƒãƒˆã‚’è¡¨ç¤º
- **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡**: ãƒ«ãƒ¼ãƒˆè©•ä¾¡ã‚’é€ä¿¡

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Nuxt 4, Vue 3, Nuxt UI
- **åœ°å›³**: Google Maps JavaScript APIï¼ˆ`gmp-` ã‚«ã‚¹ã‚¿ãƒ è¦ç´ ï¼‰

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
web/
â”œâ”€â”€ app/                     # Nuxt ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ pages/               # ãƒšãƒ¼ã‚¸ï¼ˆ/, /app/search, /app/route, /contact, /policy ç­‰ï¼‰
â”‚   â”œâ”€â”€ layouts/             # default.vue, app.vue
â”‚   â”œâ”€â”€ composables/         # useRouteApi, useSearchParams, useGenerateRequestid, states
â”‚   â”œâ”€â”€ types/               # route.ts, nuxt.d.ts
â”‚   â”œâ”€â”€ app.vue
â”‚   â””â”€â”€ app.config.ts
â”œâ”€â”€ server/api/              # Nuxt ã‚µãƒ¼ãƒãƒ¼ API
â”‚   â”œâ”€â”€ fetch-ai.post.ts     # ãƒ«ãƒ¼ãƒˆç”Ÿæˆï¼ˆAgent API ãƒ—ãƒ­ã‚­ã‚·ï¼‰
â”‚   â”œâ”€â”€ route-feedback.post.ts  # ãƒ«ãƒ¼ãƒˆè©•ä¾¡é€ä¿¡
â”‚   â””â”€â”€ gemini.post.ts       # ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”¨ãƒ†ãƒ¼ãƒ/è·é›¢ææ¡ˆï¼ˆå¤©å€™ãƒ»æ—¥æ™‚è€ƒæ…®ï¼‰
â”œâ”€â”€ assets/                  # ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆmain.css ç­‰ï¼‰
â”œâ”€â”€ public/                  # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆrobots.txt ç­‰ï¼‰
â”œâ”€â”€ nuxt.config.ts
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
### å‰ææ¡ä»¶
- Node.js 18+
- npm

### ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
cd web
npm install
```

## ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ |
|--------|------|
| `NUXT_PUBLIC_GOOGLE_MAPS_API_KEY` | Google Maps JavaScript API ç”¨ï¼ˆåœ°å›³è¡¨ç¤ºãƒ»æ¤œç´¢ï¼‰ |
| `NUXT_GEMINI_API_KEY` | ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”¨AIææ¡ˆï¼ˆãƒ†ãƒ¼ãƒ/è·é›¢ï¼‰ã«ä½¿ç”¨ã€‚æœªè¨­å®šæ™‚ã¯ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ææ¡ˆAPIãŒå‹•ä½œã—ã¾ã›ã‚“ã€‚ |

ä¾‹ï¼ˆPowerShellï¼‰:
```powershell
$env:NUXT_PUBLIC_GOOGLE_MAPS_API_KEY="YOUR_MAPS_API_KEY"
$env:NUXT_GEMINI_API_KEY="YOUR_GEMINI_API_KEY"
```

## ä½¿ç”¨æ–¹æ³•
### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
```bash
npm run dev
```

### ãƒ“ãƒ«ãƒ‰ / ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
```bash
npm run build
npm run preview
```

### é™çš„ç”Ÿæˆ
```bash
npm run generate
```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€è¦§
- `npm run dev`: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
- `npm run build`: æœ¬ç•ªãƒ“ãƒ«ãƒ‰
- `npm run preview`: ãƒ“ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- `npm run generate`: é™çš„ç”Ÿæˆ

### ä¸»è¦ãƒšãƒ¼ã‚¸
- `/`: ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã€‚æ°—åˆ†ã‚’è‰²ã§é¸ã‚“ã§æ¤œç´¢ã¸é·ç§»
- `/app/search`: ãƒ«ãƒ¼ãƒˆæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆåœ°å›³ + æ¡ä»¶å…¥åŠ›ï¼‰
- `/app/route`: ãƒ«ãƒ¼ãƒˆè¡¨ç¤ºï¼ˆåœ°å›³ + ã‚µãƒãƒª + å†æ¤œç´¢/è©•ä¾¡ï¼‰
- `/contact`: ãŠå•ã„åˆã‚ã›
- `/operator`: é‹å–¶è€…æƒ…å ±
- `/policy`: ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼
- `/terms`: åˆ©ç”¨è¦ç´„

### ä¸»è¦æ©Ÿèƒ½ã®æµã‚Œ
1. `/` ã§æ°—åˆ†ï¼ˆãƒ†ãƒ¼ãƒ/ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’é¸æŠ
2. `/app/search` ã§ç¾åœ¨åœ°ã‚’å–å¾—ã—ã€ãƒ«ãƒ¼ãƒˆæ¤œç´¢ã‚’å®Ÿè¡Œ
3. `/app/route` ã§ãƒ«ãƒ¼ãƒˆ/ã‚¹ãƒãƒƒãƒˆã‚’è¡¨ç¤ºã—ã€è©•ä¾¡ã‚’é€ä¿¡

### ã‚¯ã‚¤ãƒƒã‚¯æ¤œç´¢ï¼ˆURL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®è‰²é¸æŠã¯ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã§ `/app/search` ã«é·ç§»ã—ã¾ã™ã€‚

- `theme`: `exercise | think | refresh | nature`
- `motivation`: `light | medium | heavy`
- `quicksearch`: `true` ã®å ´åˆã¯è‡ªå‹•æ¤œç´¢

ä¾‹: `/app/search?theme=exercise&motivation=light&quicksearch=true`

## APIä»•æ§˜
ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰ã¯ Nuxt ã®ã‚µãƒ¼ãƒãƒ¼ API ã‚’çµŒç”±ã—ã¦ Cloud Runï¼ˆAgent APIï¼‰ã«æ¥ç¶šã—ã¾ã™ã€‚

- `POST /api/gemini`: ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã®ãƒ†ãƒ¼ãƒ/è·é›¢ææ¡ˆï¼ˆå¤©å€™ãƒ»æ—¥æ™‚è€ƒæ…®ï¼‰ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ model?, prevTheme?, prevDistance? }`ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ message, theme, distance_km }`ã€‚è¦ `NUXT_GEMINI_API_KEY`ã€‚
- `POST /api/fetch-ai`: ãƒ«ãƒ¼ãƒˆç”Ÿæˆï¼ˆ`request_id`, `theme`, `distance_km`, `start_location`, `end_location`, `round_trip`, `debug` ãªã©ï¼‰
- `POST /api/route-feedback`: ãƒ«ãƒ¼ãƒˆè©•ä¾¡ï¼ˆ`request_id`, `route_id`, `rating`ï¼‰

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
`POST /api/fetch-ai`
```json
{
  "request_id": "uuid",
  "theme": "exercise",
  "distance_km": 2,
  "start_location": { "lat": 35.685175, "lng": 139.752799 },
  "end_location": { "lat": 35.685175, "lng": 139.752799 },
  "round_trip": true,
  "debug": false
}
```

```json
{
  "statusCode": 200,
  "body": {
    "request_id": "uuid",
    "route": {
      "route_id": "route-id",
      "polyline": [{ "lat": 35.68, "lng": 139.75 }],
      "distance_km": 2,
      "duration_min": 30,
      "title": "title",
      "summary": "summary",
      "nav_waypoints": [{ "lat": 35.68, "lng": 139.75 }],
      "spots": [{ "name": "spot", "type": "park", "lat": 35.68, "lng": 139.75 }]
    },
    "meta": {}
  }
}
```

`POST /api/route-feedback`
```json
{
  "request_id": "uuid",
  "route_id": "route-id",
  "rating": 5
}
```

```json
{
  "statusCode": 200,
  "body": {
    "request_id": "uuid",
    "status": "accepted"
  }
}
```

## é–‹ç™ºã‚¬ã‚¤ãƒ‰
### çŠ¶æ…‹ç®¡ç†ã¨ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«
- `useSearchParams`: æ¤œç´¢æ¡ä»¶ã‚’ `useState` ã§ä¿æŒ
- `useCurrentRoute`: å–å¾—ã—ãŸãƒ«ãƒ¼ãƒˆã‚’ `useState` ã§ä¿æŒ
- `useRouteApi`: `fetch-ai` / `route-feedback` ã‚’å‘¼ã³å‡ºã™ API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `useGenerateRequestid`: `request_id` ç”Ÿæˆï¼ˆ`crypto.randomUUID()`ï¼‰

### ç”»é¢ä»•æ§˜ãƒ¡ãƒ¢
- `/app/search`: ç¾åœ¨åœ°ã®å–å¾—ã€åœ°å›³ã‚¯ãƒªãƒƒã‚¯/ãƒãƒ¼ã‚«ãƒ¼æ“ä½œã§é–‹å§‹åœ°ç‚¹ã‚’èª¿æ•´
- `/app/route`: ãƒ«ãƒ¼ãƒˆãƒãƒªãƒ©ã‚¤ãƒ³è¡¨ç¤ºã€ã‚¹ãƒãƒƒãƒˆã®ãƒ”ãƒ³è¡¨ç¤ºã€Google Maps ã«é·ç§»
- `/contact`: é€£çµ¡å…ˆè¡¨ç¤º
- `/operator`: é‹å–¶è€…æƒ…å ±
- `/policy` / `/terms`: è¦ç´„è¡¨ç¤º

### é–‹ç™ºãƒ¡ãƒ¢
- Google Maps ã®è¡¨ç¤ºã«ã¯ `gmp-map` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
- ãƒãƒƒãƒ— ID ã¯ `app/pages/app/search.vue` ã¨ `app/pages/app/route.vue` ã§è¨­å®šã—ã¦ã„ã¾ã™
- ãƒ«ãƒ¼ãƒˆç”Ÿæˆã® API æ¥ç¶šå…ˆã¯ `server/api/fetch-ai.post.ts` å†…ã® URL ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ `server/api/route-feedback.post.ts`
- ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ææ¡ˆã¯ `server/api/gemini.post.ts`ï¼ˆGemini + Open-Meteo å¤©å€™APIï¼‰ã€‚`app/pages/index.vue` ã‹ã‚‰ `/api/gemini` ã‚’å‘¼ã³å‡ºã—ã¾ã™
- Maps ã®èª­ã¿è¾¼ã¿ã¯ `NUXT_PUBLIC_GOOGLE_MAPS_API_KEY` ã‚’å‚ç…§ã—ã¾ã™
- ãƒ«ãƒ¼ãƒˆã®åº§æ¨™ã¯ `fetch-ai` ãŒ Agent ã® polyline ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦é…åˆ—ã§è¿”ã™ãŸã‚ã€ãã®ã¾ã¾æç”»ã—ã¦ã„ã¾ã™

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ / ç§˜åŒ¿æƒ…å ±
- API ã‚­ãƒ¼ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã—ã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å…¬é–‹ã•ã‚Œã‚‹å€¤ã¯ `NUXT_PUBLIC_` ä»˜ãã§å®šç¾©ã—ã¾ã™

## ãƒ†ã‚¹ãƒˆ
ç¾çŠ¶ã€å°‚ç”¨ã®ãƒ†ã‚¹ãƒˆãƒ»Lint ã‚³ãƒãƒ³ãƒ‰ã¯ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤
Docker ã§ã®èµ·å‹•æ‰‹é †ã¯ `README-DOCKER.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- åœ°å›³ãŒè¡¨ç¤ºã•ã‚Œãªã„: `NUXT_PUBLIC_GOOGLE_MAPS_API_KEY` ãŒæœªè¨­å®š/ç„¡åŠ¹ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ä½ç½®æƒ…å ±ãŒå–ã‚Œãªã„: ãƒ–ãƒ©ã‚¦ã‚¶ã®ä½ç½®æƒ…å ±è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„
- ãƒ«ãƒ¼ãƒˆç”ŸæˆãŒå¤±æ•—ã™ã‚‹: Cloud Run å´ã® API ãŒåœæ­¢ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™

### FAQ
- Q. ãƒ«ãƒ¼ãƒˆãŒæ¯å›åŒã˜ã«ãªã‚‹  
  A. `distance_km` ã‚’å¤‰æ›´ã™ã‚‹ã‹ã€å†æ¤œç´¢ã‚’è©¦ã—ã¦ãã ã•ã„
- Q. åœ°å›³ãŒç©ºç™½ã«ãªã‚‹  
  A. API ã‚­ãƒ¼è¨­å®šã¨ãƒ–ãƒ©ã‚¦ã‚¶ã®ä½ç½®æƒ…å ±è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„

## ãƒªãƒ³ã‚¯
- [ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆIaCï¼‰README](../infra/README.md)
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®README](../README.md)
- [ML Services README](../ml/README.md)
- [Dockeræ‰‹é †](./README-DOCKER.md)